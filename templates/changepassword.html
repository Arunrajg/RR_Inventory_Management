{% extends 'base.html' %}

{% block content %}
<div class="page-wrapper">
    <div class="content">
        <div class="page-header">
            <div class="page-title">
                <h4>Change Password</h4>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <form id="change-password-form" action="{{ url_for('change_password') }}" method="post">
                    <div class="row">
                        <div class="col-lg-12 col-sm-12">
                            <div class="form-group">
                                <label>Current Password</label>
                                <input type="password" name="currentpassword" id="currentpassword" class="form-control"
                                    required>
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12">
                            <div class="form-group">
                                <label>New Password</label>
                                <input type="password" name="newpassword" id="newpassword" class="form-control"
                                    required>
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12">
                            <div class="form-group">
                                <label>Confirm Password</label>
                                <input type="password" name="confirm-password" id="confirm-password"
                                    class="form-control" required>
                            </div>
                        </div>
                    </div>

                    <!-- Error Message Container -->
                    <div id="error-message" style="color: red; font-size: 14px;"></div>
                    <!-- Display flashed messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    <ul>
                        {% for category, message in messages %}
                        <li class="{{ category }}">{{ message }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% endwith %}

                    <button type="submit" id="submit-btn" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    const form = document.getElementById('change-password-form');
    const password = document.getElementById('newpassword');
    const confirmPassword = document.getElementById('confirm-password');
    const errorMessage = document.getElementById('error-message');

    form.addEventListener('submit', function (event) {
        // Clear previous error message
        errorMessage.textContent = '';

        // Check if passwords match
        if (password.value !== confirmPassword.value) {
            event.preventDefault(); // Prevent form submission
            errorMessage.textContent = 'Passwords do not match.';
        }
    });

    // Optional: Real-time validation feedback
    confirmPassword.addEventListener('input', function () {
        if (password.value === confirmPassword.value) {
            errorMessage.textContent = ''; // Clear error message
        } else {
            errorMessage.textContent = 'Passwords do not match.';
        }
    });
</script>

{% endblock %}
