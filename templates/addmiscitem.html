{% extends 'base.html' %}
{% block content %}
<div class="page-wrapper">
  <div class="content">
    <div class="page-header">
      <div class="page-title">
        <h4>Add Miscellaneous Item</h4>
      </div>
    </div>

    <form action="/addmiscitem" method="POST">
      <div class="card">
        <div class="card-body">
          <div class="row">

            <!-- Type of Expense -->
            <div class="col-lg-6 col-sm-6 col-12">
              <div class="form-group">
                <label>Type of Expense</label>
                <select name="type_of_expense" id="type_of_expense" class="form-control" required>
                  <option value="">Select Expense Type</option>
                  <option value="Owner Advance">Owner Advance</option>
                  <option value="Labor Advance">Labor Advance</option>
                  <option value="Banana Leaves">Banana Leaves</option>
                  <option value="News Paper">News Paper</option>
                  <option value="Parcel">Parcel</option>
                  <option value="Fuel">Fuel</option>
                  <option value="Salary Advance">Salary Advance</option>
                  <option value="Maintenance Charge">Maintenance Charge</option>
                  <option value="Chit Fund">Chit Fund</option>
                  <option value="Recharge">Recharge</option>
                  <option value="Firewood">Firewood</option>
                  <option value="Rent">Rent</option>
                  <option value="Electricity Bill">Electricity Bill</option>
                </select>
              </div>
            </div>

            <!-- Subcategory -->
            <div class="col-lg-6 col-sm-6 col-12" id="subcategory_div" style="display:none;">
              <div class="form-group">
                <label>Subcategory</label>
                <select name="sub_category" id="sub_category" class="form-control">
                  <option value="">Select Subcategory</option>
                </select>
              </div>
            </div>

            <!-- Restaurant -->
            <div class="col-lg-6 col-sm-6 col-12">
              <div class="form-group">
                <label>Branch (Restaurant)</label>
                <select name="restaurant_id" class="form-control">
                  <option value="">Select Branch</option>
                  {% for restaurant in restaurants %}
                  <option value="{{ restaurant.id }}" {% if restaurant.id==selected_restaurant_id %}selected{% endif %}>
                    {{ restaurant.restaurantname }}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <!-- Branch Manager -->
            <div class="col-lg-6 col-sm-6 col-12">
              <div class="form-group">
                <label>Branch Manager Name</label>
                <input type="text" name="branch_manager" class="form-control">
              </div>
            </div>

            <!-- Cost -->
            <div class="col-lg-6 col-sm-6 col-12">
              <div class="form-group">
                <label>Cost</label>
                <input type="number" step="0.01" name="cost" class="form-control" required>
              </div>
            </div>

            <!-- Notes -->
            <div class="col-lg-12">
              <div class="form-group">
                <label>Notes</label>
                <textarea name="notes" class="form-control"></textarea>
              </div>
            </div>

            <!-- Flash Messages -->
            <div>
              {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
              <ul class="flash-messages">
                {% for category, message in messages %}
                <li class="{{ category }}"><b>**{{ message }}</b></li>
                {% endfor %}
              </ul>
              {% endif %}
              {% endwith %}
            </div>

            <!-- Buttons -->
            <div class="col-lg-12">
              <button type="submit" class="btn btn-submit me-2">Submit</button>
              <a href="/miscitemlist" class="btn btn-cancel">Cancel</a>
            </div>

          </div>
        </div>
      </div>
    </form>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const subcategories = {
    "Fuel": ["Generator", "Petrol"],
    "Recharge": ["Jio", "Airtel"]
  };

  document.getElementById('type_of_expense').addEventListener('change', function () {
    let selected = this.value;
    let subCatDiv = document.getElementById('subcategory_div');
    let subCatSelect = document.getElementById('sub_category');

    subCatSelect.innerHTML = '<option value="">Select Subcategory</option>';

    if (subcategories[selected]) {
      subcategories[selected].forEach(function (sub) {
        let opt = document.createElement('option');
        opt.value = sub;
        opt.textContent = sub;
        subCatSelect.appendChild(opt);
      });
      subCatDiv.style.display = 'block';
    } else {
      subCatDiv.style.display = 'none';
    }
  });
</script>
{% endblock %}